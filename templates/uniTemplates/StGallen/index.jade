doctype html
html(lang='en',ng-app = "resumeEditApp")
    head
        title Chicago Booth Template
        meta(charset='utf-8', name='name', content='content')
        meta(name="viewport" content="initial-scale=1.0, width=device-width")
        link(rel='stylesheet', href='./static/templateSpecific/StGallen/StGallen.css')
        link(rel="stylesheet" href="./static/templateSpecific/ChicagoBooth/print.css" type="text/css" media="print")
        link(rel = 'stylesheet' href = "./static/bower_components/tether-tooltip/dist/css/tooltip-theme-arrows.css")
        link(rel='stylesheet', href='./static/bower_components/sweetalert/dist/sweetalert.css')
    body(ng-controller = "mainCtrl")
        .separated
            section.personalInformation
                .yearOfBirth(contenteditable ng-model = "resumeData.personalInformation.yearOfBirth") {{resumeData.personalInformation.yearOfBirth}} 
                .nationality(contenteditable ng-model = "resumeData.personalInformation.nationality") {{resumeData.personalInformation.nationality}}
                .residencePermit(contenteditable ng-model = "resumeData.personalInformation.residencePermit") {{resumeData.personalInformation.residencePermit}}
            section.contact
                .address(contenteditable ng-model = "resumeData.personalInformation.address") {{resumeData.personalInformation.address}}
                .phone(contenteditable ng-model = "resumeData.personalInformation.phone") {{resumeData.personalInformation.phone}}
                .email(contenteditable ng-model = "resumeData.personalInformation.email") {{resumeData.personalInformation.email}}
            section.languages
                span(ng-repeat = "language in resumeData.additional_data.languages")
            section.extraCurriculars
                ul
                    li.additionalInformation.bullet(contenteditable ng-model = "bullet.text" ng-repeat = "bullet in resumeData.additional_data.bullets") {{bullet.text}} 
            section.interests
                span(contenteditable ng-model = "resumeData.additional_data.interests[index]" ng-repeat = "(index,interest) in resumeData.additional_data.interests"){{interest + ","}}
        .rightCol
            .name(contenteditable ng-model = "resumeData.personalInformation.name") {{resumeData.personalInformation.name}}
            .profile(contenteditable ng-model = "resumeData.profile") {{resumeData.profile}} Enter Profile Here
            section.education
                h1 Education
                .educationPoint(ng-repeat = "educationPoint in resumeData.education")
                    .separated
                        .educationPoint.date(contenteditable ng-model = "educationPoint.endyear") {{educationPoint.endyear}}
                        div
                            .educationPoint.schoolname(contenteditable ng-model = "educationPoint.schoolname" ) {{educationPoint.schoolname}}
                            .educationPoint.location(contenteditable ng-model = "educationPoint.location" ) {{educationPoint.location}}
                            .educationPoint.degree(contenteditable ng-model = "educationPoint.degree") {{educationPoint.degree}}
                button(ng-click = "addEducationPoint()") Add another education detail
            section.experience
                h1  Experience
                .experiencePoint(ng-repeat = "experiencePoint in resumeData.experience")
                    .separated
                        .experiencePoint.companyname(contenteditable ng-model ="experiencePoint.companyname") {{experiencePoint.companyname}}
                        .experiencePoint.location(contenteditable ng-model ="experiencePoint.location") {{experiencePoint.location}}
                    .separated
                        .experiencePoint.designation(contenteditable ng-model ="experiencePoint.position") {{experiencePoint.position}}
                        .experiencePoint.date(contenteditable ng-model = "experiencePoint.data_raw") {{experiencePoint.data_raw}}            
                    ul
                        li.experiencePoint.bullet(contenteditable ng-model = "bullet.text" ng-repeat = "bullet in experiencePoint.bullets") {{bullet.text}}
                        button(ng-click = "addBullet(experiencePoint)") Add Bullet
                button(ng-click = "addExperiencePoint()") Add another experience detail
        script(src = "./static/bower_components/angular/angular.min.js")
        script(src = "./static/bower_components/jquery/dist/jquery.min.js")
        script(src = "./static/bower_components/sweetalert/dist/sweetalert.min.js")
        script.
            Array.prototype.remove = function(from, to) {
            var rest = this.slice((to || from) + 1 || this.length);
            this.length = from < 0 ? this.length + from : from;
            return this.push.apply(this, rest);
            };
            var resumeDataOld = !{JSON.stringify(resume)}
            for (var educationPoint of resumeDataOld.education)
            {
                educationPoint.bullets = educationPoint.bullets.map(function(bullet){
                    return {"text":bullet}
                })
            }
            for (var experiencePoint of resumeDataOld.experience)
            {
                experiencePoint.bullets = experiencePoint.bullets.map(function(bullet){
                    return {"text":bullet}
                })
            }
            function checkEmail()
            {
                if(! /^[^@\s]+@yahoo.com$/i.test(resumeDataOld.personalInformation.email))
                {
                    swal({
                        title: "Wrong email domain",
                        text: "Please use your chicagobooth.edu email",
                        type: "error",
                        closeOnConfirm: false
                    })
                    $(".email").css("background-color","#DD6B55")
                }
            }
            if (resumeDataOld.additional_data.bullets.length < 2)
            {
                swal({
                    title: "Too few bullets!",
                    text: "Please ensure you have 2-5 bullets in the 'Additional Information' section",
                    type: "error",
                    closeOnConfirm: false
                },
                function(isConfirm)
                {
                    checkEmail()
                }
                )
                $(".additional_data").css("background-color","#DD6B55")
            }
            if (resumeDataOld.additional_data.bullets.length > 5)
            {
                swal({
                    title: "Too many bullets!",
                    text: "Please ensure you have 2-5 bullets in the 'Additional Information' section",
                    type: "error",
                    closeOnConfirm: false
                },
                function(isConfirm)
                {
                    checkEmail()
                })
                $(".additionalInformation").css("background-color","#DD6B55")
            }
            
            
            
            var app = angular.module("resumeEditApp", []).controller('mainCtrl',function ($scope)
                {
                    $scope.resumeData = resumeDataOld
                    $scope.addBullet = function(point)
                    {
                        var bullet = {text: "Insert Bullet Here"}
                        point.bullets.push(bullet)
                    }
                    $scope.addEducationPoint = function()
                    {
                        //- var point = {startyear = "0000", endyear = "1000", schoolname = "University Name", degree = "Degree", bullets = {[{text: " "}]}}
                        var point = {}
                        point.date_raw = "0000-1000"
                        point.schoolname = "University Name"
                        point.degree = "Degree"
                        point.bullets = [{text:"Insert Bullet here"}]
                        $scope.resumeData.education.push(point)
                    }
                    $scope.addExperiencePoint = function()
                    {
                        //- var point = {startyear = "0000", endyear = "1000", schoolname = "University Name", degree = "Degree", bullets = {[{text: " "}]}}
                        var point = {}
                        point.data_raw = "June 0000 to May1000"
                        point.companyname = "XYZ Evil Corporation"
                        point.position = "Henchman"
                        point.industry = "Provider of Shark Traps and volcanic lairs"
                        point.location = "Inside an active volcano, obvs"
                        point.bullets = [{text:" "}]
                        $scope.resumeData.experience.push(point)
                    }
                    $scope.deleteBullet = function(index,point)
                    {
                        point.bullets.remove(index)
                    }
                })
                app.directive("contenteditable", function() {
                return {
                    restrict: "A",
                    require: "ngModel",
                    link: function(scope, element, attrs, ngModel) {

                      function read() {
                        ngModel.$setViewValue(element.text());
                      }

                      ngModel.$render = function() {
                        element.html(ngModel.$viewValue || "");
                      };

                      element.bind("blur change", function() {
                        scope.$apply(read);
                      });
                    }
                    };
                });
        script(src = "./static/bower_components/tether/dist/js/tether.min.js")
        script(src = "./static/bower_components/tether-drop/dist/js/drop.min.js")
        script(src = "./static/bower_components/tether-tooltip/dist/js/tooltip.min.js")
        script(src = "./static/templateSpecific/core.js")
        
